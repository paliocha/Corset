Corset — v1.10.0
=================

Fork of [Oshlack/Corset](https://github.com/Oshlack/Corset) v1.09.
OpenMP parallelism, htslib 1.23, C++23, and algorithmic optimisations
that reduce wall-clock time from **16+ hours to ~3.5 minutes** on
real RNA-Seq data.

Original author: Nadia Davidson (MCRI, Australia).
OpenMP/htslib/C++23 port: Martin Paliocha, 2026.

Benchmarks
----------

All benchmarks run on the NMBU Orion HPC cluster (32 CPUs, 64 GB RAM).
These are plant *de novo* transcriptome datasets from a vernalisation
time-series experiment in temperate grasses (Poaceae).  Each species
was sequenced across 5 time-points × 2 tissues (leaf/root) × 4
biological replicates = 40 RNA-Seq libraries per species.  Trinity
assemblies were quantified with Salmon (`--dumpEq`), and the
equivalence-class files are the input to Corset.

### Datasets

| Species | Code | Trinity contigs | Samples | Groups | Salmon reads |
|---------|------|-----------------|---------|--------|--------------|
| *Festuca pratensis* (meadow fescue) | FPRA | 793,420 | 40 | 10 | ~1.4 B |
| *Bromus maximus* (great brome)      | BMAX | 460,386 | 40 | 10 | ~0.8 B |

### Runtime comparison

| Dataset | Version | Threads | Wall time | Speedup | Unique clusters |
|---------|---------|---------|-----------|---------|-----------------|
| FPRA    | v1.09   | 1       | 11 h 11 min | 1×   | 463,691         |
| FPRA    | v1.10.0 | 32      | **3 min 21 s** | **200×** | 463,540    |
| BMAX    | v1.09   | 1       | 2 h 34 min  | 1×   | 270,870         |
| BMAX    | v1.10.0 | 32      | **2 min 47 s** | **55×** | 270,773    |

### Cluster-assignment comparison (v1.09 vs v1.10.0)

| Metric                         | FPRA    | BMAX    |
|--------------------------------|---------|---------|
| Transcripts                    | 793,420 | 460,386 |
| Same transcript set            | 100%    | 100%    |
| Identical cluster membership   | 95.3%   | 95.5%   |
| Different cluster membership   | 4.7%    | 4.5%    |
| Mean per-transcript Jaccard    | 0.98    | 0.98    |
| v1.09 unique clusters          | 463,691 | 270,870 |
| v1.10 unique clusters          | 463,540 | 270,773 |

The 4–5% difference is expected: Corset uses random read assignment
(`rand_r`) in the log-likelihood ratio test, and the super-cluster
parallelisation changes merge order at distance ties.  Results are
biologically equivalent.


Requirements
------------
- GCC 13+ with C++23 support
- htslib 1.23+ (headers + library)
- zlib, libbz2, liblzma, libcurl, libdeflate


Installation
------------

    ./configure
    make -j$(nproc)
    make install

To specify a non-system htslib:

    ./configure --with-htslib=/path/to/htslib/prefix


Running
-------

    corset [options] <eq_classes_files ...>

Type `corset` with no arguments for usage information.
Thread count defaults to `OMP_NUM_THREADS`; override with `-t <int>`.

More help: https://github.com/Oshlack/Corset/wiki


Container (Apptainer/Singularity)
---------------------------------

    cd containers/corset
    apptainer build --fakeroot corset_1.10.sif Corset.def


Key changes from v1.09
----------------------

### Performance
- **Adjacency-list merge** — O(degree) instead of O(n) per merge step
- **Parallel distance recomputation** — OpenMP nested parallelism for
  distance updates after each merge (>128 neighbors threshold)
- **Flat open-addressing hash map** — replaces `std::unordered_map` for
  the distance matrix; ~2–3× better cache locality
- **Early-out per sample** — skips sorted-list intersection when either
  group has zero reads
- **SSE2 block intersection** — 4-way SIMD comparison in `get_dist()`
- **Lazy-deletion max-heap** for closest-pair extraction
- **Weighted union-find** for super-cluster construction

### Architecture
- OpenMP parallel hierarchical clustering across super-clusters
- htslib 1.23 (replacing samtools 0.x inline API)
- Full C++23 standard (GCC 13, `-std=c++23`)

See [CHANGELOG.md](CHANGELOG.md) for the complete change list.


License
-------
GNU General Public License.


----
Last Modified, M. Paliocha, 20 February 2026